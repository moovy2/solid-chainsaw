#!/usr/bin/env perl
use strict;
use warnings;
use 5.010;
unless (@ARGV) {
    say <<"EOM";
Usage example:
bin/tml-get test/229Q.tml in-json | jq | bin/tml-set test/229Q.tml in-json
EOM
    exit;
}

my ($file, $section_name) = @ARGV;

unless (-f $file) {
    die "'$file' does not exist";
}

unless ($section_name) {
    die "Usage: $0 <file> <tml-section_name>";
}

open my $fh, "<", $file or die $!;
my $tml = do { local $/; <$fh> };
close $fh;

if ($tml =~ m/^\+\+\+ \Q$section_name\E\n(.*?)(?:^\+\+\+ |\z)/ms) {
    my $section = $1;
    print $section;
}
else {
    die "Could not find section $section_name in $file";
}
